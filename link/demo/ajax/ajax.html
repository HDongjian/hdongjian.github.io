<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

</body>
<script>
    var xhr = new XMLHttpRequest();
    console.log(xhr.readyState)
    xhr.open('post', 'http://localhost:3002/login', true);
    console.log(xhr.readyState)
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.send(JSON.stringify({
        username: "黄天赐"
    }));

    console.log(xhr.setRequestHeader)
    xhr.onreadystatechange = function() {
        // console.log(xhr.responseText)
        if (xhr.readyState === 4 && xhr.status == 200) {
            console.log(JSON.parse(xhr.responseText))
        }
    }
    console.log('异步')
</script>
<script>
    // var xhr = new XMLHttpRequest();

    // // console.log(xhr.readyState + 'status')
    // xhr.open('get', 'http://localhost:3002/login', true);
    // // console.log(1)
    // xhr.send();
    // // console.log(xhr.readyState + 'status')
    // // console.log(2)
    // // console.log(xhr.responseText)
    // var timeId = null;

    // timeId = setTimeout(() => {
    //     console.error('请求超时')
    // }, 2000);
    // console.log(timeId)
    // xhr.onreadystatechange = function() {

    //     if (xhr.readyState === 4) {
    //         console.log(timeId)
    //         clearTimeout(timeId)
    //     }
    //     // console.log(xhr.readyState + 'status')
    //     // console.log(xhr.responseText)
    // };
</script>
<script>
    function myAjax(type, url, param, callback) {
        //Ajax语法结构
        var xhr = null;
        if (window.XMLHttpRequest) {
            xhr = new XMLHttpRequest();
        } else {
            // xhr = new ActiveXObject('Microsoft.XMLHTTP');
            xhr = new ActiveXObject('Microsoft.XMLHTTP');
        }
        if (type == 'get') {
            url += '?' + encodeURI(param);
        }
        xhr.open(type, url);
        var data = null;
        if (type == 'post') {
            //如果是post提交，需要将参数传给send；
            data = param;
            //设置请求头
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        }
        xhr.send(data);
        //处理响应
        xhr.onreadystatechange = function() {
            if (xhr.status == 200 && xhr.readyState == 4) {
                var result = xhr.responseText;
                result = JSON.parse(result)
                callback(result);
            }
        };
    }
    // myAjax('post', 'http://localhost:3002/login', {}, function(data) {
    //     console.log(data)
    // })
</script>
<script>
    const axios = function(url, param) {
        const promise = new Promise(function(resolve, reject) {
            var xhr = null;
            var type = 'get';
            param = param || {};
            if (window.XMLHttpRequest) {
                xhr = new XMLHttpRequest();
            } else {
                xhr = new ActiveXObject('Microsoft.XMLHTTP');
            }
            // if (type == 'get') {
            //     url += '?' + encodeURI(param);
            // }
            if (type == 'get') {
                url += '?'
                for (const k in param) {
                    url += k + '=' + param[k] + '&'
                }
                url = url.substr(0, url.length - 1);
            }
            xhr.open(type, url);
            var data = null;
            if (type == 'post') {
                //如果是post提交，需要将参数传给send；
                data = param;
                //设置请求头
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            }
            xhr.send(data);
            //处理响应
            xhr.onreadystatechange = function() {
                if (xhr.readyState !== 4) {
                    return;
                }
                if (xhr.status === 200) {
                    resolve(xhr.responseText);
                } else {
                    reject(new Error(xhr.statusText));
                }
            };

        });

        return promise;
    };

    // axios("http://localhost:3002/login", {
    //     username: 124
    // }).then(function(json) {
    //     console.log(json);
    // }, function(error) {
    //     console.error('出错了', error);
    // });
</script>

<!-- <script src="./ajax.js"></script> -->
<!-- <script src="./axios.js"></script> -->

<script>
    // console.log(axios.create())
</script>

</html>